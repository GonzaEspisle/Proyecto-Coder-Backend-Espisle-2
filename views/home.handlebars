<h1>Listado de Productos</h1>
<p>Página {{page}} de {{totalPages}}</p>

{{! --- Controles de Filtro y Ordenamiento --- }}
<div style="margin-bottom: 20px;">
    <h3>Filtros y Ordenamiento</h3>
    <form action="/products" method="GET">
        <label for="query">Buscar por Categoría o Disponibilidad (true/false):</label>
        <input type="text" name="query" id="query" value="{{currentQuery}}">
        
        <label for="limit">Límite:</label>
        <input type="number" name="limit" id="limit" value="{{currentLimit}}" min="1" style="width: 50px;">
        
        <label for="sort">Ordenar por Precio:</label>
        <select name="sort" id="sort">
            {{! Uso de Helper 'eq' como bloque condicional para el atributo 'selected' }}
            <option value="" {{#eq currentSort ""}}selected{{/eq}}>Sin Orden</option>
            <option value="asc" {{#eq currentSort 'asc'}}selected{{/eq}}>Ascendente (Menor a Mayor)</option>
            <option value="desc" {{#eq currentSort 'desc'}}selected{{/eq}}>Descendente (Mayor a Menor)</option>
        </select>
        
        <button type="submit">Aplicar</button>
        <a href="/products">Limpiar Filtros</a>
    </form>
</div>
{{! --- Fin Controles --- }}


{{! --- Listado de Productos --- }}
<div class="product-list">
    {{#if products}}
        <ul>
            {{#each products}}
                <li>
                    <h4>{{this.title}}</h4>
                    <p><strong>Precio:</strong> ${{this.price}}</p>
                    <p><strong>Stock:</strong> {{this.stock}} | <strong>Categoría:</strong> {{this.category}}</p>
                    <p>
                        <a href="/products/{{this._id}}" style="margin-right: 15px;">Ver Detalle</a> 
                        <button onclick="addToCart('{{this._id}}')">🛒 Agregar al Carrito</button>
                    </p>
                    <hr>
                </li>
            {{/each}}
        </ul>
    {{else}}
        <p>No se encontraron productos con los filtros aplicados.</p>
    {{/if}}
</div>
{{! --- Fin Listado --- }}


{{! --- Paginación --- }}
<div class="pagination-controls" style="margin-top: 20px;">
    {{#if hasPrevPage}}
        <a href="{{prevLink}}">« Anterior</a>
    {{else}}
        <button disabled>« Anterior</button>
    {{/if}}

    <span style="margin: 0 15px;">Página {{page}}</span>

    {{#if hasNextPage}}
        <a href="{{nextLink}}">Siguiente »</a>
    {{else}}
        <button disabled>Siguiente »</button>
    {{/if}}
</div>
{{! --- Fin Paginación --- }}

<p style="margin-top: 30px;"><a href="/realtimeproducts">Ir a RealTimeProducts</a></p>